(()=>{"use strict";let e=e=>`https://test-sdk.paywithcitizen.com/${e}/modal`,t=(e,t,n=null)=>{if(function(e){let t=document.getElementsByTagName("script");for(let n=t.length;n--;)if(t[n].src===e)return!0;return!1}(e))n&&n();else{let s=document.createElement("script");s.type="text/javascript",s.src=e,s.integrity=t,s.crossOrigin="anonymous",n&&(s.onload=n),document.getElementsByTagName("head")[0].appendChild(s)}};class n{constructor(e){if(n.instance instanceof n)return n.instance;this.config=e,this.toggleClass=this.toggleClass.bind(this),this.showPanel=this.showPanel.bind(this),this.setActiveStep=this.setActiveStep.bind(this),this.setVisibility=this.setVisibility.bind(this),n.instance=this}toggleClass(e,t,n){e&&(n?(e.classList.remove(t),e.classList.remove("animated","fadeOut"),e.classList.add("animated","fadeIn")):(e.classList.remove("animated","fadeIn"),e.classList.add("animated","fadeOut"),e.classList.add(t)))}showPanel(e,t){this.toggleClass(e,this.config.elemStates.hidden,t)}setActiveStep(e,t){this.toggleClass(e,this.config.elemStates.activeStep,!t)}setVisibility(e,t){this.toggleClass(e,this.config.elemStates.invisible,t)}}function s(e,t,n=!1,s="click"){e.removeEventListener(s,t,n),e.addEventListener(s,t,n)}class a{constructor(){if(a.instance instanceof a)return a.instance;this.getElementById=this.getElementById.bind(this),a.instance=this}getElementById(e,t){return this[t]=document.getElementById(e),this[t]}}const i=new a;let c="v5";class o extends class{constructor(){this.state={},this.store=this.store.bind(this),this.getItem=this.getItem.bind(this)}store(e,t){this.state[e]=t}getItem(e){return this.state[e]}}{constructor(){if(super(),o.instance instanceof o)return o.instance;this.initialState={transactionId:"",userEmail:"",payInWebSocket:null,webSocketManualDisconnection:!1,reconnectionAttemptsInterval:5e3,reconnectMaximumRetries:3,webSocketMessage:null,deferLoad:!1,closeSuccessModalDelay:4,payinOptions:{},isSmallScreen:window.innerWidth<=760,payInCallBackTimeoutId:null,payInCancelledTimeoutId:null,payInResendTimeoutId:null,depositSelectedBank:null,isQrCodePayIn:!1,emailPayInSteps:null},this.reset=this.reset.bind(this),this.reset(),o.instance=this}reset(){this.state={...this.state,...this.initialState,payinOptions:{},emailPayInSteps:null}}}const l=new o,r=class{constructor(e){this.container=e.container,this.steps=e.steps,this.modalAssetsPath=e.modalAssetsPath,this.hideClass=e.hideClass?e.hideClass:"ctzn__hidden",this.constructStepsElements=this.constructStepsElements.bind(this),this.createFailureIcon=this.createFailureIcon.bind(this),this.createSuccessIcon=this.createSuccessIcon.bind(this),this.constructStepsElements()}constructStepsElements(){const e={};Object.entries(this.steps).map(([t,n],s)=>{const a=this.createContainer(t,n.className),i=this.createLoader(t),c=this.createSuccessIcon(t),o=this.createFailureIcon(t),l=this.createStepText(t,n.text);this.hide(c),this.hide(o),a.appendChild(i),a.appendChild(c),a.appendChild(o),a.appendChild(l),e[t]={section:a},Object.defineProperty(e[t],"loader",{get:function(){return document.getElementById(i.id)}}),Object.defineProperty(e[t],"successIcon",{get:function(){return document.getElementById(c.id)}}),Object.defineProperty(e[t],"failureIcon",{get:function(){return document.getElementById(o.id)}}),Object.defineProperty(e[t],"text",{get:function(){return document.getElementById(l.id)}})}),Object.values(e).map(e=>this.container.appendChild(e.section)),this.stepsElement=e}hide(e){e.classList.add(this.hideClass)}show(e){e.classList.remove(this.hideClass)}createContainer(e,t){const n=document.createElement("div");return n.classList.add("ctzn__step"),t&&n.classList.add(t),n.id="step_"+e,n}createLoader(e){const t=document.createElement("div");return t.classList.add("ctzn__step__loader"),t.id=`step_${e}_loader`,t}createSuccessIcon(e){const t=document.createElement("img");return t.classList.add("ctzn__step__success__image"),t.id=`step_${e}_success_icon`,t.src=this.modalAssetsPath+"/assets/images/svg/success_modal_tick.svg",t.alt="Success step",t}createFailureIcon(e){const t=document.createElement("img");return t.classList.add("ctzn__step__success__image"),t.id=`step_${e}_failure_icon`,t.src=this.modalAssetsPath+"/assets/images/svg/not_authorised.svg",t.alt="Unauthorised step",t}createStepText(e,t){const n=document.createElement("div");return n.classList.add("ctzn__step__text"),n.id=`step_${e}_text`,n.innerHTML=t,n}},p=({url:e,data:t,publicApiKey:n,method:s})=>new Promise((a,i)=>{let c=new XMLHttpRequest;c.open(s,e,!0),c.setRequestHeader("Content-type","application/json"),c.setRequestHeader("AuthorizationCitizen",n),c.onload=()=>{if(4===c.readyState&&200===c.status&&c.response)try{a(JSON.parse(c.response))}catch{a(c.response)}else i(c)},c.onerror=()=>{i(c)},c.send(t)});function d(e){return(({url:e,data:t,publicApiKey:n})=>p({method:"GET",url:e,data:t,publicApiKey:n}))({url:"https://testapi.paywithcitizen.com/v2/merchant/logo",publicApiKey:e})}function m(e){const t=l.getItem("publicApiKey");let n=new XMLHttpRequest;return n.open("POST","https://testapi.paywithcitizen.com"+e,!0),n.setRequestHeader("Content-type","application/json"),n.setRequestHeader("AuthorizationCitizen",t),n}function u(){const e=i.payInLinkReSend,t=i.payInReSendContainer,n=l.getItem("payInResendTimeoutId"),a=l.getItem("userEmail"),c=l.getItem("transactionId"),o=l.getItem("publicApiKey");e.removeEventListener("click",u,!1),clearTimeout(n),function(e,t){return(({url:e,data:t,publicApiKey:n})=>p({method:"POST",url:e,data:t,publicApiKey:n}))({url:"https://testapi.paywithcitizen.com/v2/payins/send-transaction-email",data:e,publicApiKey:t})}(c,o).then(()=>{t.innerHTML='An email has been sent to <strong id="payment-resend-email-text"></strong>',document.getElementById("payment-resend-email-text").innerText=a}).catch(()=>{t.innerHTML='We were unable to send email to <strong id="payment-resend-email-text"></strong>. Please try again.',document.getElementById("payment-resend-email-text").innerText=a}).finally(()=>{const e=setTimeout(()=>{t.innerHTML='Didnâ€™t get an email? <a href="#" id="payment-resend-email">Resend email</a>',s(document.getElementById("payment-resend-email"),u)},3e3);l.store("payInResendTimeoutId",e)})}function y(){I(),Y()}function _(){const e=l.getItem("webSocketMessage");e?be(e.body):ce()}function I(){const e=l.getItem("payInModal");ee(),he(null),e.close()}const g=()=>{ie()};let h,b,E,C,f,v,R,z,T,S,P,A,L,N,k,w,O,x,U,M,B,D,H,F,K,q,Q,V,G,j,$,J,W,Z=function(e){null!=e?(l.store("webSocketMessage",e),e.body===de.PENDING_USER_AUTHORISATION||e.body===de.PENDING_ASPSP_ACCEPTANCE?be(e.body):(be(e.body),ee())):(be(de.ERROR),ee())};function Y(){const e=l.getItem("payInFailureRedirectUrl"),t=l.getItem("failureCallback"),n=l.getItem("webSocketMessage");return new Promise(s=>{e?window.location.replace(e):(t&&t(n.body),s())})}function X(){const e=l.getItem("paymentWebSocket");e&&e.reconnect()}function ee(){const e=l.getItem("paymentWebSocket");e&&e.disconnect()}function te(){const e=l.getItem("transactionId"),t=l.getItem("reconnectionAttemptsInterval"),n=l.getItem("reconnectMaximumRetries"),s=new CitizenWebSocket.PaymentWebSocket({channelId:e,reconnectionAttemptsInterval:t,reconnectMaximumRetries:n,reconnectFailureCallback:g,subscriptionCallback:Z});l.store("paymentWebSocket",s),s.connect()}function ne(){const e=l.getItem("payinQRRedirectUrl");ee(),window.location.replace(e)}function se(){const e=i.companyLogo,t=l.getItem("payInModal");_e(e,!0),be(de.INITIALIZATION_FAILURE),!t.isOpen()&&t.open()}function ae(){var e,t;(e=l.getItem("transactionId"),t=l.getItem("publicApiKey"),(({url:e,data:t,publicApiKey:n})=>p({method:"PUT",url:e,data:t,publicApiKey:n}))({url:"https://testapi.paywithcitizen.com"+(e=>"/v2/payins/merchant/decline/"+e)(e),publicApiKey:t})).finally(()=>{l.store("webSocketMessage",{body:de.BANKS_PAGE_CANCELLATION}),I(),Y()})}function ie(){window.removeEventListener("focus",X,!1),s(A,y),he("payinExceptionPanel")}function ce(){const t=l.getItem("userEmail");U.innerHTML=`<div class="ctznpayment__step_header" >Now use your phone</div>\n                            <div class="ctznpayment__step_header_sub">\n                             Open the secure email we sent to\n                             <span class="ctznpayment__step_header_sub bold" id="payment-userEmail">${t}</span>\n                     </div>`,h=i.getElementById("payment-userEmail","payinUserEmailTextn"),x.innerHTML=' <section class="ctznpayment__app__info">\n                 <div class="ctznpayment__app_text_1">Don\'t have your phone or bank app installed?</div>\n                 <div class="ctznpayment__app_text_2">You can open the email on this device. You will need your online banking login information to approve the payment</div>\n                </section>\n                \n                <section class="ctznpayment__links">\n                    <div class="ctznpayment__links__resend" id="ctznpayment__resend__container">\n                      Didnâ€™t get an email? <a href="#" id="payment-resend-email">Resend email</a>\n                    </div>\n                </section>',N=i.getElementById("payment-resend-email","payInLinkReSend"),L=i.getElementById("ctznpayment__resend__container","payInReSendContainer"),O.innerHTML="";const n=new r({steps:me,container:O,modalAssetsPath:e(c)});l.store("emailPayInSteps",n);const a=n.stepsElement;l.store("webSocketMessage",null),_e(j,!0),le(a),_e(a.step1.loader,!0),Ie(a.step1.section,!0),_e(a.step2.loader,!0),_e(a.step3.loader,!0),_e(x,!0),_e(E,!1),h.innerText=t,a.step3.text.innerHTML="Processing your payment, please wait...",s(N,u),he("payInPanel"),!W.isOpen()&&W.open()}function oe(){const e=l.getItem("payinCallBackTimeoutId");clearTimeout(e),W.close()}function le(e){_e(e.step3.section,!1),_e(e.step3.loader,!1),_e(e.step3.successIcon,!1),Ie(e.step3.section,!1),ge(e.step3.section,!1),_e(e.step2.section,!0),_e(e.step2.loader,!1),_e(e.step2.successIcon,!1),_e(e.step2.failureIcon,!1),Ie(e.step2.section,!1),ge(e.step2.section,!0),_e(e.step1.section,!0),_e(e.step1.loader,!1),_e(e.step1.successIcon,!1),_e(e.step1.failureIcon,!1),Ie(e.step1.section,!1),ge(e.step1.section,!0)}class re{constructor(){if(re.instance instanceof re)return re.instance;this.init=this.init.bind(this),Object.freeze(this),re.instance=this}init(){const e=i.getElementById;h=e("payment-userEmail","payinUserEmailTextn"),b=e("payment-statusMessage","paymentStatusMessage"),E=e("payment-successButton","payinButtonSuccess"),C=e("payment-failureCancelPayment","payinButtonFailureCancel"),f=e("payment-buttonWrongEmail","payinButtonWrongEmail"),v=e("payment-sendEmail","payinButtonChangeEmail"),R=e("payment-cancelPayment","payinButtonCancelPayin"),z=e("payment-continuePayment","payinButtonContinuePayin"),S=e("payment-cancelledCancelButton","payinButtonCloseButtonCancelled"),T=e("payment-consent-failure-close","payinButtonConsentClose"),P=e("payment-buttonCloseTimeout","payinButtonTimeoutClose"),A=e("payment-buttonCloseException","payinButtonExceptionClose"),k=e("ctznpayment__qr__code__container","qrCodeContainer"),U=e("ctznpayment__steps__header","stepsHeader"),O=e("ctznpayment__steps__container","stepsContainer"),x=e("ctznpayment__steps__footer","stepsFooter"),M=e("payment-awaiting-email","payInPanel"),B=e("payment-exception","payinExceptionPanel"),D=e("payment-timeout","payinTimeoutPanel"),H=e("payment-failure","payinFailurePanel"),F=e("payment-warning","warningPanel"),K=e("payment-headerPanel","paymentHeader"),q=e("payment-loading","loadingPanel"),Q=e("payment-cancelled","payinCancelPanel"),V=e("payment-consent-failure","payinConsentFailurePanel"),G=e("ctznpayment__bank__info__container","bankInfoContainer"),j=e("company-logo","companyLogo"),$=e("ctznpayment__bank__logo","bankLogo"),J=e("ctznpayment__bank__name","bankName"),W=l.getItem("payInModal")}}const pe=new re;let de={ERROR:"ERROR",FAILED:"FAILED",ACCEPTED:"ACCEPTED",TIMEOUT:"TIMEOUT",EMAIL_SENT:"EMAIL_SENT",INITIATED:"INITIATED",CANCELLED:"CANCELLED",PENDING_USER_AUTHORISATION:"PENDING_USER_AUTHORISATION",PENDING_ASPSP_ACCEPTANCE:"PENDING_ASPSP_ACCEPTANCE",CONSENT_URL_RETRIEVAL_ERROR:"CONSENT_URL_RETRIEVAL_ERROR",BANKS_PAGE_CANCELLATION:"BANKS_PAGE_CANCELLATION",LOADING:"LOADING",QRCode_CONSENT:"QRCode_CONSENT",INITIALIZATION_FAILURE:"INITIALIZATION_FAILURE"},me={step1:{loader:null,successIcon:null,failureIcon:null,section:null,text:"Select your bank on your phone"},step2:{loader:null,successIcon:null,failureIcon:null,section:null,text:"Approve payment in your bank's app"},step3:{loader:null,successIcon:null,text:"Processing your payment, please wait...",section:null}},ue={step1:{loader:null,successIcon:null,failureIcon:null,section:null,text:"Scan the QR and select your bank on your phone",className:"qrcode__step"},step2:{loader:null,successIcon:null,failureIcon:null,section:null,text:"Approve payment in your bank's app",className:"qrcode__step"},step3:{loader:null,successIcon:null,text:"Processing your payment, please wait...",section:null,className:"qrcode__step"}};const ye=new n({regExPattern:{email:/[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?/,number:/^\+[1-9]{1}[0-9]{3,14}$/},elemStates:{hidden:"ctzn__hidden",activeStep:"active-step",invisible:"ctzn__invisible"}}),_e=ye.showPanel,Ie=ye.setActiveStep,ge=ye.setVisibility;function he(e){if("warningPanel"!==e&&"payinCancelPanel"!==e){const e=i.paymentHeader;_e(e,!0)}const t={payInPanel:i.payInPanel,payinTimeoutPanel:i.payinTimeoutPanel,payinExceptionPanel:i.payinExceptionPanel,payinFailurePanel:i.payinFailurePanel,warningPanel:i.warningPanel,loadingPanel:i.loadingPanel,payinCancelPanel:i.payinCancelPanel,payinConsentFailurePanel:i.payinConsentFailurePanel};Object.entries(t).map(([t,n])=>{_e(n,t===e)})}function be(t,n){switch(t){case de.TIMEOUT:window.removeEventListener("focus",X,!1),s(P,y),he("payinTimeoutPanel");break;case de.FAILED:window.removeEventListener("focus",X,!1),s(C,y),he("payinFailurePanel");break;case de.ERROR:ie();break;case de.EMAIL_SENT:ce();break;case de.ACCEPTED:!function(){window.removeEventListener("focus",X,!1);const e=l.getItem("closeSuccessModalDelay"),t=l.getItem("emailPayInSteps").stepsElement,n=setTimeout(()=>{W.close()},1e3*e);l.store("payinCallBackTimeoutId",n),s(E,oe),le(t),t.step3.text.innerHTML="Payment complete",_e(x,!1),_e(E,!0),_e(t.step3.section,!0),_e(t.step3.successIcon,!0),ge(t.step3.section,!0),_e(t.step2.successIcon,!0),_e(t.step1.successIcon,!0),he("payInPanel")}();break;case de.PENDING_USER_AUTHORISATION:!function(){L&&_e(L,!1);const e=l.getItem("emailPayInSteps").stepsElement;le(e),_e(e.step3.section,!1),_e(e.step3.loader,!1),ge(e.step3.section,!1),_e(e.step2.loader,!0),Ie(e.step2.section,!0),_e(e.step1.successIcon,!0),N&&s(N,u),he("payInPanel")}();break;case de.PENDING_ASPSP_ACCEPTANCE:!function(){const e=l.getItem("emailPayInSteps").stepsElement;le(e),_e(e.step3.section,!0),_e(e.step3.loader,!0),Ie(e.step3.section,!0),ge(e.step3.section,!0),_e(e.step2.successIcon,!0),_e(e.step1.successIcon,!0),N&&s(N,u),he("payInPanel");const t=setTimeout(()=>{e.step3.text.innerHTML="This is taking longer than usual. Still processing..."},3e4);l.store("processingTimeoutId",t)}();break;case de.CANCELLED:!function(e){const t=l.getItem("emailPayInSteps").stepsElement;L&&_e(L,!1),le(t),_e(t.step2.failureIcon,!0),Ie(t.step2.section,!0),_e(t.step1.successIcon,!0),N&&(N.disable=!0);const n=setTimeout(()=>{N&&(N.disable=!1),_e(K,!1),s(S,y),he("payinCancelPanel")},2e3);l.store("payinCancelledTimeoutId",n)}();break;case de.BANKS_PAGE_CANCELLATION:!function(){const e=l.getItem("emailPayInSteps").stepsElement;L&&_e(L,!1),le(e),_e(e.step1.failureIcon,!0),Ie(e.step1.section,!0),_e(e.step1.successIcon,!1),_e(e.step2.loader,!0),N&&(N.disable=!0);const t=setTimeout(()=>{N&&(N.disable=!1),_e(K,!1),s(S,y),he("payinCancelPanel")},2e3);l.store("payinCancelledTimeoutId",t)}();break;case de.INITIALIZATION_FAILURE:case de.CONSENT_URL_RETRIEVAL_ERROR:s(T,I),he("payinConsentFailurePanel"),!W.isOpen()&&W.open();break;case de.QRCode_CONSENT:!function(){l.store("webSocketMessage",{body:de.QRCode_CONSENT});let t=l.getItem("emailPayInSteps");if(!t){x.innerHTML='<div class="ctznpayment__links" id="ctznpayment__resend__container" style="padding: 16px;">\n                       <a href="#" class="ctznpayment__links__resend" id="ctznpayment_qr__continue">\n                       Don\'t have your phone? Click here to continue on this device\n                       </a>\n                    </div>',U.innerHTML='<div class="ctznpayment__step_header" >Pay faster with your bank app</div>\n    <div class="ctznpayment__step_header_sub">\n        Scan this one-time QR code with your phone\'s camera app to open a secure webpage where you select your bank.\n    </div>',O.innerHTML='<div id="ctznpayment__qr__code__container"></div>',L=i.getElementById("ctznpayment_qr__continue","payInReSendContainer"),w=i.getElementById("ctznpayment__qr__code__container","qrCodeStepContainer"),t=new r({steps:ue,container:O,modalAssetsPath:e(c)});const n=l.getItem("payinQRRedirectUrl");Ie(t.stepsElement.step1.section,!0),ge(t.stepsElement.step3.section,!1),new QRCode(w,{text:n,correctLevel:QRCode.CorrectLevel.H,useSVG:!0}),_e(x,!0),_e(E,!1),s(L,ne),l.store("emailPayInSteps",t)}he("payInPanel"),!W.isOpen()&&W.open()}();break;case de.LOADING:_e(j,!1),he("loadingPanel"),!W.isOpen()&&W.open();break;default:ie()}}try{window.CITIZEN_PAYIN||function(){let n=function(){const t=i.payinExceptionPanel,n=i.payinTimeoutPanel,a=i.payinButtonSuccess,o=i.payInReSendContainer,r=i.bankInfoContainer,p=i.companyLogo,d=l.getItem("emailPayInSteps"),m=l.getItem("payinCallBackTimeoutId"),y=l.getItem("payinCancelledTimeoutId"),_=l.getItem("payInResendTimeoutId"),I=l.getItem("processingTimeoutId");if(t.classList.contains("ctzn__hidden")||Y(),n.classList.contains("ctzn__hidden")||Y(),a.classList.contains("ctzn__hidden")||function(){const e=l.getItem("payInSuccessRedirectUrl");new Promise(t=>{e?window.location.replace(e):t()})}(),ee(),l.reset(),p.src=e(c)+"/assets/images/png/citizen-logo.png",d&&(d.stepsElement.step1.text.innerHTML="Select your bank on your phone",d.stepsElement.step2.text.innerHTML="Approve payment in your bank's app"),o){o.innerHTML='Didnâ€™t get an email? <a href="#" id="payment-resend-email">Resend email</a>';const e=document.getElementById("payment-resend-email");e&&s(e,u),_e(o,!0)}_e(r,!1),clearTimeout(m),clearTimeout(y),clearTimeout(_),clearTimeout(I),window.removeEventListener("focus",X,!1)};const a=function(){const e=i.payInPanel,t=i.payinButtonSuccess,n=i.loadingPanel,a=i.warningPanel;return!e.classList.contains("ctzn__hidden")&&t.classList.contains("ctzn__hidden")?(s(R,ae),s(z,_),_e(K,!1),he("warningPanel"),!1):!!n.classList.contains("ctzn__hidden")&&a.classList.contains("ctzn__hidden")};function o(){!function(e,t){const n=l.getItem("transactionId");let s=t("/v2/payins/initialise-email");s.send(n),s.onload=()=>{if(4===s.readyState&&200===s.status){if(s.response){window.addEventListener("focus",X,!1);let e=JSON.parse(s.response);e.citizenTransactionId&&(l.store("citizenTransactionId",e.citizenTransactionId),l.store("payInSuccessRedirectUrl",e.successRedirectUrl),l.store("payInFailureRedirectUrl",e.failureRedirectUrl)),be(de.EMAIL_SENT);const t=l.getItem("initiatedCallback");t&&t()}te()}else se()},s.onerror=()=>{se()}}(0,m)}function r(){!function(e,t){const n=l.getItem("transactionId"),s=l.getItem("depositAccountId"),a=l.getItem("depositSelectedBank"),c=l.getItem("payinEmailInitiatedCallback"),o=i.bankLogo,r=i.bankName,p=i.bankInfoContainer;let d=t("/v2/payins/verified/initialise-email");const m={citizenTransactionId:n,customerBankAccountId:s};d.send(JSON.stringify(m)),d.onload=()=>{if(4===d.readyState&&200===d.status){if(d.response){window.addEventListener("focus",X,!1);let e=JSON.parse(d.response);me.step1.text=`On your phone use the email, to take you to <span class="ctznpayment__bank__name">${a.name}'s app</span>`,me.step2.text=`Approve the payment in ${a.name}'s app`,be(de.EMAIL_SENT),o.src=a.logo,r.innerHTML=a.name,_e(p,!0),c&&c(),e.id&&(l.store("paymentTokenId",e.id),l.store("payInSuccessRedirectUrl",e.successRedirectUrl),l.store("payInFailureRedirectUrl",e.failureRedirectUrl))}te()}else se()},d.onerror=()=>{se()}}(0,m)}function p(){const e=l.getItem("transactionId"),t=l.getItem("depositAccountId"),n=l.getItem("depositSelectedBank"),s=l.getItem("payinEmailInitiatedCallback"),a=i.bankLogo,c=i.bankName,o=i.bankInfoContainer;let r=m("/v2/payins/verified/initialise-qr-code");const p={citizenTransactionId:e,customerBankAccountId:t};r.send(JSON.stringify(p)),r.onload=()=>{if(4===r.readyState&&200===r.status){if(r.response){window.addEventListener("focus",X,!1);let e=JSON.parse(r.response);if(e.redirectUrl){const t=new URL(decodeURIComponent(e.redirectUrl)),i={};t.search.replace("?","").split("&").map(e=>{const t=e.split("=");i[t[0]]=t[1]}),l.store("payInSuccessRedirectUrl",e.successRedirectUrl),l.store("payInFailureRedirectUrl",e.failureRedirectUrl),l.store("payinQRRedirectUrl",e.redirectUrl),ue.step1.text=`Scan the QR to redirect to <span class="ctznpayment__bank__name">${n.name}'s app</span>`,ue.step2.text=`Approve the payment in ${n.name}'s app`,a.src=n.logo,c.innerHTML=n.name,_e(o,!0),s&&s(),be(de.QRCode_CONSENT),te()}else be(de.CONSENT_URL_RETRIEVAL_ERROR)}}else be(de.ERROR)},r.onerror=()=>{}}function y(){!function(e,t){const n=l.getItem("transactionId");let s=t("/v2/payins/initialise-qr-code");s.send(n),s.onload=()=>{if(4===s.readyState&&200===s.status){let e=JSON.parse(s.response);if(e&&e.redirectUrl){const t=new URL(decodeURIComponent(e.redirectUrl)),n={};t.search.split("&").map(e=>{const t=e.split("=");n[t[0]]=t[1]}),l.store("citizenTransactionId",n["transaction-id"]),l.store("payInSuccessRedirectUrl",e.successRedirectUrl),l.store("payInFailureRedirectUrl",e.failureRedirectUrl),l.store("payinQRRedirectUrl",e.redirectUrl),be(de.QRCode_CONSENT);const s=l.getItem("initiatedCallback");s&&s(),te()}else be(de.CONSENT_URL_RETRIEVAL_ERROR)}else be(de.CONSENT_URL_RETRIEVAL_ERROR)},s.onerror=()=>{be(de.CONSENT_URL_RETRIEVAL_ERROR)}}(0,m)}window.CITIZEN_PAYIN={init:s=>{s.publicApiKey&&l.store("publicApiKey",""+s.publicApiKey),s.closeSuccessModalDelay&&l.store("closeSuccessModalDelay",s.closeSuccessModalDelay),((e,t)=>{if(!function(e){let t=document.getElementsByTagName("link");for(let n=t.length;n--;)if(t[n].href===e)return!0;return!1}(e)){let t=document.createElement("link");t.rel="stylesheet",t.type="text/css",t.href=e,t.integrity="sha384-1I7fi50hqWZaAI7QErl1lnJzf1HsTMCerWuyRozY9JxrXdV1Zk06EdjxIi4Ogb/n",t.crossOrigin="anonymous",document.getElementsByTagName("head")[0].appendChild(t)}})(e(c)+"/css/style.css"),t(e(c)+"/js/script.js","sha384-Sv3TVReHhOV1/aDMbxGJ01NAd7cHXVuLQA/nq27qUmkgnmJp0L5MhlKR9LKtrZtw",()=>{t(e(c)+"/js/citizen-utils-websocket.js","sha384-nJcozxe1FQh/Pssw9g6m20ZG+y/O2/z/iAQ8AF8aHILxJVFliIH7HWhKo5ZDmM8R",()=>{const t=(({onCloseModal:t,beforeCloseModal:n,dist:s})=>{let a=e(s);const i=new tingle.modal({footer:!1,stickyFooter:!1,closeMethods:["overlay","escape"],closeLabel:"",cssClass:["ctznverified"],onClose:t,beforeClose:n});return i.setContent(`\n        <div class='ctznpayment' id="payment-modal">\n       \n            <div class="ctznpayment__card">\n          \n              \x3c!-- HEADER --\x3e\n              <header class="ctznpayment__container__header" id="payment-headerPanel">\n                <div class="ctznpayment__header__title">Instant Bank Payment</div>\n                <div class="ctznpayment__header__logocontainer">\n                  <img class="ctznpayment__header__logo" \n                       id="company-logo"\n                       src="${a}/assets/images/png/citizen-logo.png"\n                       alt="Citizen">\n                </div>\n              </header>\n  \n              \x3c!-- CENTRAL CONTENT --\x3e\n             <section class="ctznpayment__container__centre" id="payment-awaiting-email">\n        \n                <section class="ctznpayment__step__container">\n                <section id="ctznpayment__bank__info__container" class="ctzn__hidden">\n                  <div class="ctznpayment__bank__info">\n                   <img id="ctznpayment__bank__logo" src="${a}/assets/images/png/citizen-logo.png" alt="bank-logo">\n                   <span id="ctznpayment__bank__name">Bank</span>\n                  </div>\n                  <div class="ctznpayment__divider"></div>\n                </section>\n                  <section class="ctznpayment__emailLink" id="ctznpayment__steps__header"></section>\n               \n                  <section class="ctznpayment__step__loader__container" id="ctznpayment__steps__container"></section>\n                 </section>\n                 <section id="ctznpayment__steps__footer"></section>\n                 <section class="ctznpayment__actions" >\n                        <button class="ctznbtn ctznbtn--primary ctzn__hidden" id="payment-successButton">\n                            DONE\n                        </button>\n                 </section>\n                \n              </section>\n              \n              <section class="ctznpayment__container" id="payment-warning">\n                <img class="ctznpayment__tip__image mrg-b-32" \n                        src="${a}/assets/images/svg/warning_icon.svg" \n                        alt="Fingerprint">\n                <div class="ctznpayment__text__bold mrg-b-32 mrg-t-16">Are you sure you want to cancel the payment?</div>\n                <div class="ctznpayment__text mrg-b-40 fs--16">Closing this pop up window will cancel the payment</div>\n                <div class="ctznpayment__actions">\n                   <button class="ctznbtn ctznbtn--primary ctznpayment" id="payment-cancelPayment">\n                       Cancel payment\n                   </button>\n                   <button class="ctznbtn ctznbtn--primary ctznpayment" id="payment-continuePayment">\n                       Continue with payment\n                   </button>\n                </div>\n              </section>\n              \n                \n               <section class="ctznpayment__container" id="payment-timeout">\n                   <div class="ctznpayment__text__bold mrg-b-16">Your session timed out</div>\n                   <div class="ctznpayment__text mrg-t-16 mrg-b-56">For security, we've timed out your session.<br/>Please try again</div>\n                     <div class="ctznpayment__actions">\n                          <button class="ctznbtn ctznbtn--primary ctznpayment" id="payment-buttonCloseTimeout">\n                             CLOSE\n                          </button>\n                      </div>\n               </section>\n               \n               <section class="ctznpayment__container" id="payment-exception">\n                   <div class="ctznpayment__text__bold mrg-b-16">Oops something went wrong</div>\n                   <div class="ctznpayment__text mrg-t-16 mrg-b-72">Please check with your bank to see if the payment went through</div>\n                      <div class="ctznpayment__actions">\n                          <button class="ctznbtn ctznbtn--primary ctznpayment" id="payment-buttonCloseException">\n                             CLOSE\n                          </button>\n                      </div>\n               </section>\n               \n                <section class="ctznpayment__container" id="payment-consent-failure">\n                   <div class="ctznpayment__text__bold mrg-b-16">Oops something went wrong</div>\n                   <div class="ctznpayment__text mrg-t-16 mrg-b-72">Please try again.</div>\n                      <div class="ctznpayment__actions">\n                          <button class="ctznbtn ctznbtn--primary ctznpayment" id="payment-consent-failure-close">\n                              CLOSE\n                          </button>\n                      </div>\n               </section>\n               \n               <section class="ctznpayment__container" id="payment-failure">\n                   <div class="ctznpayment__text__bold mrg-b-16">Oops something went wrong</div>\n                   <div class="ctznpayment__text mrg-t-16 mrg-b-72">The payment failed to go through</div>\n                      <div class="ctznpayment__actions">\n                        <button class="ctznbtn ctznbtn--primary ctznpayment" id="payment-failureCancelPayment">\n                            CLOSE\n                        </button>\n                      </div>\n               </section>\n               \n                <section class="ctznpayment__container" id="payment-cancelled">\n                   <img class="ctznpayment__tip__image mrg-b-32" \n                        src="${a}/assets/images/svg/warning_icon.svg" \n                        alt="Fingerprint">\n                   <div class="ctznpayment__text__bold mrg-b-8">Your payment wasn't authorised</div>\n                   <div class="ctznpayment__text mrg-t-16 mrg-b-72">You can close and try again with another bank or try a different payment method</div>\n                      <div class="ctznpayment__actions">\n                        <button class="ctznbtn ctznbtn--primary ctznpayment" id="payment-cancelledCancelButton">\n                            CLOSE\n                        </button>\n                      </div>\n               </section>\n               \n                 <section class="ctzn__loader__container" id="payment-loading">\n                     <div class="ctzn__loader__text">Please wait</div>\n                     <div class="ctzn__loader__spinner"></div>\n                </section>\n                \n            </section>\n              \x3c!-- FOOTER --\x3e\n              <footer class="ctznpayment__container__footer">\n                <img class="ctznpayment__secured__image" src="${a}/assets/images/svg/secured_by_citizen.svg" alt="Citizen">\n              </footer>\n          </div>\n         \n        </div>\n      `),i})({onCloseModal:n,beforeCloseModal:a,dist:c});l.store("payInModal",t),pe.init()})})},startPayInJourney:e=>{e?(l.store("transactionId",e),function(e,t){const n=l.getItem("transactionId");let s=t("/v2/payins/initialise");s.send(n),s.onload=()=>{if(4===s.readyState&&308===s.status)if(s.response){let e=s.response;window.open(e,"_self")}else be(de.CONSENT_URL_RETRIEVAL_ERROR);else be(de.CONSENT_URL_RETRIEVAL_ERROR)},s.onerror=()=>{be(de.CONSENT_URL_RETRIEVAL_ERROR)}}(0,m)):console.error("Please provide a valid transaction ID as is required.")},startEmailPayInJourney:(e,t={})=>{const n=Object.assign({},t);l.store("payinOptions",n);const s=t.initiatedCallback;l.store("initiatedCallback",s);const a=t.customerEmailAddress?t.customerEmailAddress:"you";l.store("userEmail",a);const c=t.failureCallback;l.store("failureCallback",c),e?(l.store("transactionId",e),s||be(de.LOADING),d(l.getItem("publicApiKey")).then(e=>{e.data&&(i.companyLogo.src="data:img/png;base64,"+e.data)}).finally(o)):console.error("Please provide a valid transaction ID as is required.")},startDepositPayment:(e,t,n,s={})=>{const a=s.initiatedCallback;l.store("payinEmailInitiatedCallback",a);const c=Object.assign({},s);l.store("payinOptions",c);const o=t.accountId;l.store("depositAccountId",o);const p=t;if(l.store("depositSelectedBank",p),p)if(e&&e){const t=n||"you";l.store("transactionId",e),l.store("userEmail",t),d(l.getItem("publicApiKey")).then(e=>{e.data&&(i.companyLogo.src="data:img/png;base64,"+e.data)}).finally(r)}else console.error("Please provide a valid transaction ID as is required.");else console.error("Please provide the selected bank details.")},startVerifiedDepositQRCodePayInJourney:(e,t,n,s={})=>{const a=s.initiatedCallback;l.store("payinEmailInitiatedCallback",a);const c=Object.assign({},s);l.store("payinOptions",c);const o=t.accountId;l.store("depositAccountId",o);const r=t;if(l.store("depositSelectedBank",r),r)if(e){const t=n||"you";l.store("transactionId",e),l.store("userEmail",t),d(l.getItem("publicApiKey")).then(e=>{e.data&&(i.companyLogo.src="data:img/png;base64,"+e.data)}).finally(p)}else console.error("Please provide a valid transaction ID as is required.");else console.error("Please provide the selected bank details.")},startQRCodePayInJourney:(e,t={})=>{if(e){l.store("transactionId",e),l.store("isQrCodePayin",!0);const n=t.initiatedCallback;l.store("initiatedCallback",n);const s=t.failureCallback;l.store("failureCallback",s),n||be(de.LOADING),d(l.getItem("publicApiKey")).then(e=>{e.data&&(i.companyLogo.src="data:img/png;base64,"+e.data)}).finally(y)}else console.error("Please provide a valid transaction ID as is required.")}},console.log("CITIZEN_PAYIN Version:","5.0.0"),window.citizenAsyncInit&&window.citizenAsyncInit()}()}catch(e){}})();
